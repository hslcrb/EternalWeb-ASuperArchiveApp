{% load static tz core_tags %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <title>{{title}}</title>
        <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1">
        <link href="{% static 'bootstrap.min.css' %}" rel="stylesheet">
        <style>
            /* Keep this inline, don't move to external css file because this template is used to generate static exports that need to be usable as-is without an accompanying staticfiles dir */
            html, body {
                width: 100%;
                height: 100%;
                background-color: #ddd;
            }
            header {
                background-color: #aa1e55;
            }
            small {
                font-weight: 200;
            }
            header a:hover {
                text-decoration: none;
            }
            .header-top {
                width: 100%;
                height: auto;
                min-height: 40px;
                margin: 0px;
                text-align: center;
                color: #f6f6f6;
                font-size: calc(10px + 0.84vw);
                font-weight: 200;
                padding: 3px 4px;
                background-color: #aa1e55;
            }
            .header-top .nav {
                width: 100%;
            }
            .nav > div {
                min-height: 30px;
                line-height: 1.2;
            }
            .header-top .header-url {
                display: inline-block;
                width: 100%;
                background-color: rgb(216, 216, 235, 0.05);
                text-align: center;
                line-height: 1.3;
                font-family: monospace;
                white-space: nowrap;
                font-weight: 200;
                display: block;
                margin-top: -1px;
                font-size: 23px;
                opacity: 0.8;
                border-radius: 0px 0px 8px 8px;
            }
            .header-top .header-url a.header-url-text {
                color: #f6f6f6;
                user-select: all;
                text-overflow: ellipsis;
            }
            .header-top .header-url a.header-url-text:hover {
                color: rgb(144, 161, 255);
            }
            .header-top a {
                text-decoration: none;
                color: rgba(0,0,0,0.6);
            }
            .header-top a:hover {
                text-decoration: none;
                color: rgba(0,0,0,0.9);
            }
            .header-top .header-title {
                color: rgba(0,0,0,0.6);
            }
            .header-top .favicon {
                height: 24px;
                vertical-align: -5px;
                margin-right: 4px;
            }
            .header-top .col-lg-4 {
                text-align: center;
                padding-top: 4px;
                padding-bottom: 4px;
            }
            .header-archivebox img {
                display: inline-block;
                margin-right: 3px;
                height: 30px;
                margin-left: 12px;
                margin-top: -4px;
                margin-bottom: 2px;
            }
            .header-archivebox img:hover {
                opacity: 0.5;
            }
            header small code {
                white-space: nowrap;
                font-weight: 200;
                display: block;
                margin-top: -1px;
                font-size: 13px;
                opacity: 0.8;
                user-select: all;
            }
            .header-toggle {
                line-height: 12px;
                font-size: 70px;
                vertical-align: -12px;
                margin-left: 4px;
            }
            
            .info-row {
                margin-top: 2px;
                margin-bottom: 5px;
            }
            .info-row .alert {
                margin-bottom: 0px;
            }
            .row.header-bottom {
                margin-left: -10px;
                margin-right: -10px;
            }
            .header-bottom .col-lg-2 {
                padding-left: 4px;
                padding-right: 4px;
            }

            .header-bottom-frames .card {
                box-shadow: 2px 2px 7px 0px rgba(0, 0, 0, 0.1);
                margin-bottom: 6px;
                border: 1px solid rgba(0, 0, 0, 0.06);
                border-radius: 10px;
                background-color: #efefef;
                overflow: hidden;
                min-height: 130px;
            }
            .header-bottom-frames .card:has([data-compact]) {
                min-height: 0;
            }
            .card h4 {
                font-size: 0.8em;
                display: inline-block;
                width: auto;
                text-transform: uppercase;
                margin-top: 0px;
                margin-bottom: 5px;
                color: #222;
            }
            .card-body {
                font-size: 14px;
                padding: 4px 10px;
                padding-bottom: 0px;
                /* padding-left: 3px; */
                /* padding-right: 3px; */
                /* padding-bottom: 3px; */
                line-height: 1;
                word-wrap: break-word;
                max-height: 102px;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #222;
                background-color: #f6f6f6;
            }
            .card-title {
                margin-bottom: 4px;
                text-transform: uppercase;
            }
            .card-img-top {
                border: 0px;
                padding: 0px;
                margin: 0px;
                overflow: hidden;
                opacity: 0.8;
                border-top: 1px solid rgba(0,0,0,0);
                border-radius: 4px;
                border-bottom: 1px solid rgba(0,0,0,0);
                height: 430px;
                width: 405%;
                margin-bottom: -330px;
                background-color: #333;
                margin-left: -1%;
                margin-right: -1%;
                pointer-events: none;

                transform: scale(0.25); 
                transform-origin: 0 0;
            }
            #main-frame {
                border-top: 1px solid #ddd;
                width: 100%;
                height: calc(100vh - 210px);
                margin: 0px;
                border: 0px;
                border-top: 3px solid #aa1e55;
            }
            #main-frame-wrapper {
                width: 100%;
                height: calc(100vh - 210px);
                border-top: 3px solid #aa1e55;
                overflow: hidden;
            }
            #main-frame-wrapper iframe {
                width: 100%;
                height: 100%;
                border: none;
            }
            .full-page-wrapper {
                width: 100%;
                height: calc(100vh - 210px);
            }
            .thumbnail-wrapper {
                height: 100px;
                overflow: hidden;
                background-color: #333;
                pointer-events: none;
            }
            .thumbnail-wrapper.compact {
                height: 32px;
                background-color: #111;
            }
            .thumbnail-wrapper iframe {
                width: 405%;
                height: 430px;
                margin-bottom: -330px;
                margin-left: -1%;
                transform: scale(0.25);
                transform-origin: 0 0;
                border: none;
            }
            .thumbnail-wrapper img {
                width: 100%;
                height: 100%;
                object-fit: cover;
                object-position: top center;
            }
            .thumbnail-compact {
                height: 32px;
                display: flex;
                align-items: center;
                gap: 6px;
                padding: 0 8px;
                font-size: 13px;
                line-height: 1;
                color: #bdbdbd;
                text-transform: uppercase;
                letter-spacing: 0.02em;
            }
            .thumbnail-compact-label {
                color: #e1e1e1;
            }
            .thumbnail-compact-meta {
                color: #777;
                font-size: 11px;
                margin-left: auto;
            }
            .thumbnail-compact svg,
            .thumbnail-compact img {
                height: 12px;
                width: 12px;
            }
            .thumbnail-text {
                height: 100px;
                background: #121212;
                color: #d8d8d8;
                padding: 6px 8px;
                display: flex;
                flex-direction: column;
                gap: 4px;
                font-family: SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                font-size: 11px;
                line-height: 1.2;
                overflow: hidden;
            }
            .thumbnail-text-header {
                display: flex;
                align-items: center;
                gap: 6px;
                font-size: 10px;
                color: #9b9b9b;
                text-transform: uppercase;
                letter-spacing: 0.04em;
            }
            .thumbnail-text-pre {
                margin: 0;
                white-space: pre-wrap;
                overflow: hidden;
                display: -webkit-box;
                -webkit-box-orient: vertical;
                -webkit-line-clamp: 5;
            }
            .thumbnail-text[data-plugin="title"] .thumbnail-text-pre {
                font-size: 13px;
                font-weight: 600;
                -webkit-line-clamp: 3;
            }
            .card.selected-card {
                border: 2px solid orange;
                box-shadow: 0px -6px 13px 1px rgba(0,0,0,0.05);
            }
            .thumb-compact .card-body {
                display: block;
                padding: 4px 8px;
                font-size: 12px;
                line-height: 1.2;
                max-height: none;
            }
            .thumb-compact {
                margin-bottom: 0px;
                border-radius: 6px;
            }
            .thumb-compact .thumbnail-wrapper {
                height: 32px;
            }
            .thumb-compact .thumbnail-compact,
            .thumb-compact .thumbnail-text {
                height: 32px;
                max-height: 32px;
            }
            .iframe-large {
                height: calc(100vh - 70px);
            }
            img.external {
                height: 30px;
                margin-right: -10px;
                padding: 3px;
                border-radius: 4px;
                vertical-align: middle;
                border: 4px solid rgba(0,0,0,0);
            }
            img.external:hover {
                border: 4px solid green;
            }
            .screenshot {
                background-color: #333;
                transform: none;
                width: 100%;
                min-height: 100px;
                max-height: 100px;
                margin-bottom: 0px;
                object-fit: cover;
                object-position: top center;
            }
            .thumb-grid {
                display: block;
                column-width: 180px;
                column-gap: 6px;
                align-content: start;
                width: 100%;
            }
            .thumb-card {
                box-shadow: 2px 2px 7px 0px rgba(0, 0, 0, 0.1);
                border: 1px solid rgba(0, 0, 0, 0.06);
                border-radius: 10px;
                background-color: #efefef;
                overflow: hidden;
                display: inline-block;
                width: 100%;
                break-inside: avoid;
                box-sizing: border-box;
                margin-bottom: 6px;
                height: 138px;
                min-height: 138px;
                max-height: 138px;
            }
            .thumb-card:has([data-compact]) {
                height: 46px;
                min-height: 46px;
                max-height: 46px;
            }
            .thumb-card .thumb-body {
                font-size: 14px;
                padding: 3px 8px;
                line-height: 1.2;
                word-wrap: break-word;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #222;
                background-color: #f6f6f6;
            }
            .thumb-card .thumb-body h4 {
                font-size: 0.8em;
                text-transform: uppercase;
                margin: 0 0 2px 0;
                color: #222;
                line-height: 1.1;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .thumb-card .thumbnail-wrapper,
            .thumb-card iframe.card-img-top {
                display: block;
                width: 100%;
            }
            .thumb-card:has([data-compact]) .thumbnail-wrapper,
            .thumb-card:has([data-compact]) .thumbnail-wrapper.compact {
                height: 24px;
                flex: 0 0 auto;
            }
            .thumb-card:has([data-compact]) .thumb-body {
                padding: 2px 6px;
                font-size: 12px;
                max-height: 20px;
            }
            .thumb-card:has([data-compact]) .thumb-body h4 {
                font-size: 0.9em;
                margin-bottom: 0px;
                line-height: 1;
                display: flex;
                align-items: center;
                gap: 4px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
            .thumb-card.selected-card {
                border: 2px solid orange;
                box-shadow: 0px -6px 13px 1px rgba(0,0,0,0.05);
            }
            .header-bottom {
                border-top: 1px solid rgba(170, 30, 85, 0.9);
                padding-bottom: 1px;
                border-bottom: 5px solid rgb(170, 30, 85);
                margin-bottom: -1px;

                border-radius: 0px;
                background-color: #f4eeee;
                border: 1px solid rgba(0,0,0,0.2);
                box-shadow: 4px 4px 4px rgba(0,0,0,0.2);
                margin-top: 0px;
            }
            .header-bottom.container-fluid {
                padding-left: 6px;
                padding-right: 6px;
            }
            .header-bottom-info {
                color: #6f6f6f;
                padding-top: 0px;
                padding-bottom: 0px;
                margin: 0px -15px;
            }

            .header-bottom-info > div {
                text-align: center;
            }
            .header-bottom-info h5 {
                font-size: 12px;
                font-weight: 400;
                margin-top: 3px;
                margin-bottom: 3px;
            }
            .info-chunk {
                width: auto;
                display: inline-block;
                text-align: center;
                margin: 8px 4px;
                vertical-align: top;
                font-size: 14px;
            }
            header .badge {
                margin-top: 3px;
                font-size: 0.9rem;
                font-weight: 200;
                font-family: monospace;
            }
            header .internal-links {
                text-align: left;
                opacity: 1;
                background-color: rgba(0,0,0,0.03);
                padding: 1px 3px;
            }
            header .external-links {
                text-align: center;
                opacity: 0.9;
                /*background-color: rgba(0,0,0,0.03);*/
                margin-top: 0px;
                padding: 1px 3px;
                font-size: 14px;
                color: #ddd;
                width: 100%;
                overflow: hidden;
            }
            .row.header-bottom-frames {
                padding-top: 5px;
                display: block !important;
                width: 100%;
                max-width: 100%;
                column-width: 180px;
                column-gap: 8px;
                column-fill: auto;
                margin-left: 0px;
                margin-right: 0px;
                flex: none !important;
            }
            .header-bottom-frames .col-lg-2 {
                padding-left: 0px;
                padding-right: 0px;
                max-width: 100%;
                width: 100% !important;
                display: inline-block !important;
                float: none !important;
                flex: none !important;
                break-inside: avoid;
                margin-bottom: 6px;
                vertical-align: top;
            }
            .header-bottom-frames .card:has([data-compact]) .thumbnail-wrapper,
            .header-bottom-frames .card:has([data-compact]) .thumbnail-wrapper.compact {
                height: 32px;
            }
            .header-bottom-frames .card:has([data-compact]) .thumbnail-text {
                height: auto;
                max-height: 64px;
            }
            .header-bottom-frames .card:has([data-compact]) .card-body {
                padding: 4px 8px;
                max-height: 44px;
            }
            .header-bottom-frames .card-title {
                width: 100%;
                text-align: center;
                font-size: 17px;
                margin-bottom: 0px;
                display: inline-block;
                color: #222;
                font-weight: 200;
                vertical-align: 3px;
            }
            .header-bottom-frames .card-text {
/*                width: 100%;
                text-align: center;*/
                font-size: 0.9em;
                display: inline-block;
                position: relative;
/*                top: -11px;*/
            }
            .card-text code {
                padding: .1rem .2rem;
                font-size: 90%;
                color: #bd4147;
                background-color: rgb(204, 204, 204, 0.28);
                border-radius: .25rem;
            }

            /*@media(max-width: 1092px) {
                iframe {
                    display: none;
                }
            }*/
                

            @media(max-width: 728px) {
                .card h4 {
                    font-size: 5vw;
                }
                .card-body {
                    font-size: 4vw;
                }
                .card {
                    margin-bottom: 5px;
                }
                header > h1 > a.header-url, header > h1 > a.header-archivebox {
                    display: none;
                }
            }
        </style>
    </head>
    <body>
        <header>
            <div class="header-top container-fluid">
                <div class="row nav">
                    <div class="col-lg-2" style="line-height: 58px; vertical-align: middle">
                        <a href="../../index.html" class="header-archivebox" title="Go to Main Index...">
                            <img src="../../static/archive.png" alt="Archive Icon">
                            ArchiveBox
                        </a>
                    </div>
                    <div class="col-lg-8">
                        <div class="header-url">
                            <a class="header-url-text" href="{{url}}" title="Open original URL in new window..." target="_blank" rel="noreferrer">
                                {{url}}
                            </a>
                        </div>
                        <div class="badge badge-{{status_color}}" style="float: left">
                            <a href="/admin/core/snapshot/?q={{snapshot_id}}" title="Click to see options to pull, re-snapshot, or delete this Snapshot">
                                {{status|upper}}
                            </a>
                        </div>
                        <div class="badge badge-default" style="float: left; font-weight: 200">
                            {{num_outputs}}
                            {% if num_failures %}
                                + {{num_failures}} <small>errors</small>
                            {% endif %}
                        </div>
                        <div class="badge badge-info" style="float: right">
                            <a href="/admin/core/snapshot/{{snapshot_id}}/change/" title="Click to edit this Snapshot in the Admin UI">
                                {{size}}
                            </a>
                        </div>
                        <div class="badge badge-default" style="float: right">
                            <a href="/admin/core/snapshot/{{snapshot_id}}/change/" title="Click to edit this Snapshot in the Admin UI">
                                {{extension}}
                            </a>
                        </div>
                        <small class="header-title header-toggle-trigger">
                            <img src="favicon.ico" onerror="this.style.opacity=0" alt="Favicon" class="favicon"/>
                            {{title|truncatechars:120|safe}} <a href="#" class="header-toggle header-toggle-trigger">‚ñæ</a>
                            <br/>
                            {% for tag in tags_str|split:',' %}
                                <div class="badge badge-default tag" style="word-break: break-all;">{{tag}}</div>
                            {% endfor %}
                        </small>
                    </div>
                    <div class="col-lg-2" style="padding-top: 4px">
                        <a href="/{{archive_path}}/index.html" title="Date Added: {{bookmarked_date}}  |  First Archived: {{oldest_archive_date|default:downloaded_datestr}}  |  Last Checked: {{downloaded_datestr}}   (UTC)">
                            {{oldest_archive_date|default:downloaded_datestr|default:bookmarked_date}}
                        </a>
                        <br/>
                        <div class="external-links">
                            ‚ÜóÔ∏è &nbsp;
                            <a href="./index.json" title="Get the Snapshot details as a JSON file" target="_blank">JSON</a> &nbsp;|&nbsp; üóÉÔ∏è 
                            <a href="{{warc_path}}" title="Download the ArchiveBox-generated WARC file" target="_blank">WARC</a>  &nbsp;|&nbsp; 
                            <a href="https://web.archive.org/web/{{url}}" title="Search for a copy of the URL saved in Archive.org" target="_blank" rel="noreferrer">üèõÔ∏è Archive.org</a>
                            <!--<a href="https://archive.md/{{url}}" title="Search for a copy of the URL saved in Archive.today" target="_blank" rel="noreferrer">Archive.today</a>  &nbsp;|&nbsp; -->
                            <!--<a href="https://ghostarchive.org/search?term={{url|urlencode}}" title="Search for a copy of the URL saved in GhostArchive.org" target="_blank" rel="noreferrer">More...</a>-->
                        </div>
                    </div>
                </div>
            </div>
            <div class="header-bottom container-fluid">
                <div class="thumb-grid">
                    
                    
                    {% for result in archiveresults %}
                        <div class="thumb-card{% if forloop.first %} selected-card{% endif %}">
                            {% with display_path=result.path %}
                                <div class="thumb-body">
                                    {% if display_path %}
                                        <a href="{{display_path|urlencode}}" target="preview" title="./{{display_path}} (downloaded {{result.ts}})">
                                            <h4>{% plugin_icon result.name %} {{result.name|plugin_name|truncatechars:20}} <small>({{result.size|filesizeformat}})</small></h4>
                                        </a>
                                    {% else %}
                                        <h4>{% plugin_icon result.name %} {{result.name|plugin_name|truncatechars:20}} <small>({{result.size|filesizeformat}})</small></h4>
                                    {% endif %}
                                </div>
                                {% if result.result and display_path %}
                                    {# Use plugin-specific card template when ArchiveResult is available #}
                                    <div class="card-img-top thumbnail-wrapper">
                                        {% plugin_card result.result %}
                                    </div>
                                {% elif result.is_metadata and display_path %}
                                    <div class="card-img-top thumbnail-wrapper compact">
                                        <div class="thumbnail-compact" data-plugin="{{result.name}}">
                                            <span class="thumbnail-compact-icon">{% plugin_icon result.name %}</span>
                                            <span class="thumbnail-compact-label">{{result.name|plugin_name}}</span>
                                            <span class="thumbnail-compact-meta">metadata</span>
                                        </div>
                                    </div>
                                {% elif display_path %}
                                    {# Fall back to generic iframe for filesystem-discovered files #}
                                    <iframe class="card-img-top" src="{{display_path|urlencode}}?autoplay=0" allow="autoplay 'none'; fullscreen 'none'; navigation-override 'none'; " sandbox="allow-same-origin allow-top-navigation-by-user-activation allow-scripts allow-forms" scrolling="no" loading="lazy"></iframe>
                                {% endif %}
                            {% endwith %}
                        </div>
                    {% endfor %}


                    <div class="thumb-card">
                            <div class="thumb-body">
                                <a href="./" target="preview">
                                    <h4>Headers, JSON, etc.</h4>
                                </a>
                                <!--<a href="{{result.path|urlencode}}" target="preview"><h4 class="card-title">{{result.name}}</h4></a>-->
                            </div>
                            <iframe class="card-img-top" src="./" sandbox="" scrolling="no" loading="lazy"></iframe>
                        </div>
                </div>
            </div>
        </header>



        {% if best_result.result %}
            {# Use plugin-specific fullscreen template when ArchiveResult is available #}
            <div id="main-frame-wrapper" class="full-page-wrapper">
                {% plugin_full best_result.result %}
            </div>
        {% else %}
            {# Fall back to generic iframe #}
            <iframe id="main-frame" sandbox="allow-same-origin allow-top-navigation-by-user-activation allow-scripts allow-forms" class="full-page-iframe" src="{{best_result.path|default:'about:blank'|urlencode}}" name="preview"></iframe>
        {% endif %}
    


        <script src="{% static 'jquery.min.js' %}" type="text/javascript"></script>

        <script>
            // un-sandbox iframes showing pdfs (required to display pdf viewer)
            jQuery('iframe').map(function() {
                if (this.src.endsWith('.pdf')) {
                    this.removeAttribute('sandbox')
                    this.src = this.src + '#toolbar=0'
                }
                this.onload = function() {
                    if (this.src.includes('.pdf')) {
                        this.removeAttribute('sandbox')
                        this.src = this.src.split('?autoplay=')[0] + '#toolbar=0'
                    }
                    try {
                        // doesnt work if frame origin rules prevent accessing its DOM via JS
                        this.contentWindow.scrollTo(0, 0);
                    } catch(err) {}
                }
            })

            function getPreviewTypeFromPath(link) {
                if (link.getAttribute('href') == './') {
                    return 'all'
                }
                return link.getAttribute('href')
            }

            function ensureMainFrame() {
                let frame = document.getElementById('main-frame')
                if (!frame) {
                    const wrapper = document.getElementById('main-frame-wrapper')
                    frame = document.createElement('iframe')
                    frame.id = 'main-frame'
                    frame.name = 'preview'
                    frame.className = 'full-page-iframe'
                    frame.sandbox = "allow-same-origin allow-top-navigation-by-user-activation allow-scripts allow-forms"
                    if (wrapper) {
                        wrapper.innerHTML = ''
                        wrapper.appendChild(frame)
                        wrapper.classList.remove('full-page-wrapper')
                    }
                }
                return frame
            }

            for (const card of [...document.querySelectorAll('.thumb-card')]) {
                card.addEventListener('click', function(event) {
                    const link = event.target.closest('a[target=preview]') || event.currentTarget.querySelector('a[target=preview]') || event.currentTarget.querySelector('a')
                    if (!link) {
                        return
                    }
                    const target = link.href
                    if (!target || target.endsWith('#')) {
                        return
                    }

                    jQuery('.selected-card').removeClass('selected-card')
                    jQuery(event.currentTarget).closest('.thumb-card').addClass('selected-card')

                    const iframe_elem = ensureMainFrame()
                    if (target.endsWith('.pdf')) {
                        iframe_elem.removeAttribute('sandbox')
                    } else {
                        iframe_elem.sandbox = "allow-same-origin allow-top-navigation-by-user-activation allow-scripts allow-forms"
                    }
                    window.location.hash = getPreviewTypeFromPath(link)

                    iframe_elem.src = target
                })
            }


            function hideSnapshotHeader() {
                console.log('Collapsing Snapshot header...')
                jQuery('.header-toggle').text('‚ñ∏')
                jQuery('.header-bottom').hide()
                jQuery('#main-frame').addClass('iframe-large')
                try {
                    localStorage.setItem("archivebox-snapshot-header-visible", "false")
                } catch (e) {
                    console.log('Could not use localStorage to persist header collapse state', e)
                }
            }
            function showSnapshotHeader() {
                console.log('Expanding Snapshot header...')
                jQuery('.header-toggle').text('‚ñæ')
                jQuery('.header-bottom').show()
                jQuery('#main-frame').removeClass('iframe-large')
                try {
                    localStorage.setItem("archivebox-snapshot-header-visible", "true")
                } catch (e) {
                    console.log('Could not use localStorage to persist header collapse state', e)
                }
            }
            function loadSnapshotHeaderState() {
                // collapse snapshot header if user has previously hidden it
                let snapshotHeaderIsExpanded = 'false'
                try {
                    snapshotHeaderIsExpanded = localStorage.getItem("archivebox-snapshot-header-visible") || 'false'
                } catch (e) {
                    console.log('Could not use localStorage to get header collapse state', e)
                }
                if (snapshotHeaderIsExpanded === 'false') {
                    hideSnapshotHeader()
                }
            }
            function handleSnapshotHeaderToggle() {
                if (jQuery('.header-toggle').text().includes('‚ñæ')) {
                    hideSnapshotHeader()
                } else {
                    showSnapshotHeader()
                }
                return true
            }

            // hide header when collapse icon is clicked
            jQuery('.header-toggle').on('click', handleSnapshotHeaderToggle)
            jQuery('.header-toggle-trigger').on('click', handleSnapshotHeaderToggle)

            // check URL for hash e.g. #git and load relevant preview
            jQuery(document).ready(function() {
                if (window.location.hash) {
                    for (const link of jQuery('a[target=preview]')) {
                        console.log(link.pathname)
                        if (getPreviewTypeFromPath(link) == window.location.hash.slice(1).toLowerCase()) {
                            jQuery(link).closest('.thumb-card').click()
                            jQuery(link).click()
                            link.click()
                        }
                    }
                }
                loadSnapshotHeaderState()
            })

            

            // hide all preview iframes on small screens
            // if (window.innerWidth < 1091) {
            //     jQuery('.card a[target=preview]').attr('target', '_self')
            // }
        </script>
    </body>
</html>
